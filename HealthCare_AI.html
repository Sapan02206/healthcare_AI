<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI MediCare Assistant - Advanced Health & Student Helper</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pulse-icon {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        @keyframes floating {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        .severity-critical { background: linear-gradient(135deg, #ff6b6b, #ee5a52); }
        .severity-high { background: linear-gradient(135deg, #ffa726, #ff9800); }
        .severity-moderate { background: linear-gradient(135deg, #ffeb3b, #ffc107); }
        .severity-low { background: linear-gradient(135deg, #66bb6a, #4caf50); }
        .glass-effect {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .symptom-tag {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border: 1px solid #2196f3;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Header with Advanced Design -->
    <div class="container mx-auto px-4 py-6">
        <div class="text-center mb-8">
            <div class="floating mb-4">
                <i class="fas fa-robot text-6xl text-white mb-4"></i>
            </div>
            <h1 class="text-5xl font-bold text-white mb-2">
                <i class="fas fa-heartbeat text-red-300 mr-3"></i>
                AI MediCare Assistant
            </h1>
            <p class="text-white/80 text-lg">Advanced AI-powered health analysis and student support system</p>
            <div class="flex justify-center items-center mt-4 space-x-6 text-white/70">
                <div class="flex items-center">
                    <i class="fas fa-shield-alt mr-2"></i>
                    <span>HIPAA Compliant</span>
                </div>
                <div class="flex items-center">
                    <i class="fas fa-clock mr-2"></i>
                    <span>24/7 Available</span>
                </div>
                <div class="flex items-center">
                    <i class="fas fa-globe mr-2"></i>
                    <span>Multi-language</span>
                </div>
            </div>
        </div>

        <!-- Module Selection with Advanced Cards -->
        <div id="moduleSelection" class="grid md:grid-cols-2 gap-8 mb-8 max-w-4xl mx-auto">
            <div class="glass-effect rounded-2xl p-8 cursor-pointer card-hover" onclick="activateSymptomDetector()">
                <div class="text-center">
                    <div class="relative mb-6">
                        <i class="fas fa-stethoscope text-6xl text-blue-400 pulse-icon"></i>
                        <div class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs">
                            <i class="fas fa-plus"></i>
                        </div>
                    </div>
                    <h3 class="text-2xl font-bold text-white mb-3">
                        <i class="fas fa-brain mr-2 text-pink-300"></i>
                        AI Symptom Detector
                    </h3>
                    <p class="text-white/80 mb-4">Advanced symptom analysis with personalized recommendations</p>
                    <div class="flex justify-center space-x-4 text-sm text-white/70">
                        <span><i class="fas fa-camera mr-1"></i>Image Analysis</span>
                        <span><i class="fas fa-chart-line mr-1"></i>Risk Assessment</span>
                        <span><i class="fas fa-user-md mr-1"></i>Expert System</span>
                    </div>
                </div>
            </div>
            
            <div class="glass-effect rounded-2xl p-8 cursor-pointer card-hover" onclick="activateStudentHelper()">
                <div class="text-center">
                    <div class="relative mb-6">
                        <i class="fas fa-graduation-cap text-6xl text-green-400 pulse-icon"></i>
                        <div class="absolute -top-2 -right-2 bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs">
                            <i class="fas fa-edit"></i>
                        </div>
                    </div>
                    <h3 class="text-2xl font-bold text-white mb-3">
                        <i class="fas fa-file-alt mr-2 text-yellow-300"></i>
                        Student Helper
                    </h3>
                    <p class="text-white/80 mb-4">Smart leave management and academic support tools</p>
                    <div class="flex justify-center space-x-4 text-sm text-white/70">
                        <span><i class="fas fa-envelope mr-1"></i>Auto Send</span>
                        <span><i class="fas fa-file-pdf mr-1"></i>PDF Export</span>
                        <span><i class="fas fa-calendar mr-1"></i>Smart Dates</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Symptom Detector Module -->
        <div id="symptomDetector" class="hidden max-w-6xl mx-auto">
            <div class="glass-effect rounded-2xl p-8 mb-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-3xl font-bold text-white flex items-center">
                        <i class="fas fa-stethoscope mr-3 text-blue-400"></i>
                        AI Symptom Detector
                        <span class="ml-3 text-sm bg-green-500 text-white px-3 py-1 rounded-full">
                            <i class="fas fa-shield-alt mr-1"></i>Secure
                        </span>
                    </h2>
                    <button onclick="goBack()" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-all">
                        <i class="fas fa-arrow-left mr-2"></i>Back
                    </button>
                </div>
                
                <!-- Patient Information Panel -->
                <div id="patientInfo" class="grid md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-white/10 rounded-lg p-4">
                        <label class="block text-white/80 text-sm font-medium mb-2">
                            <i class="fas fa-user mr-2"></i>Age Group
                        </label>
                        <select id="ageGroup" class="w-full p-2 bg-white/20 border border-white/30 rounded-lg text-white focus:ring-2 focus:ring-blue-400">
                            <option value="">Select age group</option>
                            <option value="child">Child (0-12)</option>
                            <option value="teen">Teen (13-17)</option>
                            <option value="adult">Adult (18-64)</option>
                            <option value="senior">Senior (65+)</option>
                        </select>
                    </div>
                    <div class="bg-white/10 rounded-lg p-4">
                        <label class="block text-white/80 text-sm font-medium mb-2">
                            <i class="fas fa-venus-mars mr-2"></i>Gender
                        </label>
                        <select id="gender" class="w-full p-2 bg-white/20 border border-white/30 rounded-lg text-white focus:ring-2 focus:ring-blue-400">
                            <option value="">Select gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="bg-white/10 rounded-lg p-4">
                        <label class="block text-white/80 text-sm font-medium mb-2">
                            <i class="fas fa-globe mr-2"></i>Language
                        </label>
                        <select id="languageSelect" class="w-full p-2 bg-white/20 border border-white/30 rounded-lg text-white focus:ring-2 focus:ring-blue-400">
                            <option value="en">🇺🇸 English</option>
                            <option value="hi">🇮🇳 हिंदी (Hindi)</option>
                            <option value="es">🇪🇸 Español</option>
                            <option value="fr">🇫🇷 Français</option>
                            <option value="ar">🇸🇦 العربية</option>
                            <option value="zh">🇨🇳 中文</option>
                        </select>
                    </div>
                </div>

                <!-- Advanced Symptom Input -->
                <div id="initialSymptoms" class="mb-6">
                    <div class="bg-white/10 rounded-lg p-6">
                        <label class="block text-white text-lg font-medium mb-4">
                            <i class="fas fa-comment-medical mr-2 text-red-300"></i>
                            Describe your symptoms in detail:
                        </label>
                        <textarea id="symptomsInput" class="w-full p-4 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:ring-2 focus:ring-blue-400" rows="4" placeholder="Please describe what you're experiencing (e.g., fever since 2 days, severe headache, difficulty breathing...)"></textarea>
                        
                        <!-- Quick Symptom Tags -->
                        <div class="mt-4">
                            <p class="text-white/80 text-sm mb-2">
                                <i class="fas fa-tags mr-2"></i>Quick select common symptoms:
                            </p>
                            <div class="flex flex-wrap gap-2" id="symptomTags">
                                <span class="symptom-tag px-3 py-1 rounded-full text-sm cursor-pointer hover:bg-blue-200 transition-colors" onclick="addSymptomTag('fever')">
                                    <i class="fas fa-thermometer-half mr-1"></i>Fever
                                </span>
                                <span class="symptom-tag px-3 py-1 rounded-full text-sm cursor-pointer hover:bg-blue-200 transition-colors" onclick="addSymptomTag('headache')">
                                    <i class="fas fa-head-side-cough mr-1"></i>Headache
                                </span>
                                <span class="symptom-tag px-3 py-1 rounded-full text-sm cursor-pointer hover:bg-blue-200 transition-colors" onclick="addSymptomTag('cough')">
                                    <i class="fas fa-lungs mr-1"></i>Cough
                                </span>
                                <span class="symptom-tag px-3 py-1 rounded-full text-sm cursor-pointer hover:bg-blue-200 transition-colors" onclick="addSymptomTag('nausea')">
                                    <i class="fas fa-dizzy mr-1"></i>Nausea
                                </span>
                                <span class="symptom-tag px-3 py-1 rounded-full text-sm cursor-pointer hover:bg-blue-200 transition-colors" onclick="addSymptomTag('fatigue')">
                                    <i class="fas fa-bed mr-1"></i>Fatigue
                                </span>
                                <span class="symptom-tag px-3 py-1 rounded-full text-sm cursor-pointer hover:bg-blue-200 transition-colors" onclick="addSymptomTag('chest pain')">
                                    <i class="fas fa-heart mr-1"></i>Chest Pain
                                </span>
                            </div>
                        </div>
                        
                        <!-- Advanced Image Upload -->
                        <div class="mt-6 grid md:grid-cols-2 gap-4">
                            <div class="bg-white/10 rounded-lg p-4 border-2 border-dashed border-white/30">
                                <label class="block text-white/80 text-sm font-medium mb-2">
                                    <i class="fas fa-camera mr-2 text-green-300"></i>Upload symptom images (optional)
                                </label>
                                <input type="file" id="symptomImage" accept="image/*" multiple class="w-full p-2 bg-white/20 border border-white/30 rounded-lg text-white">
                                <p class="text-white/60 text-xs mt-2">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Supported: rashes, swelling, wounds, etc.
                                </p>
                            </div>
                            <div class="bg-white/10 rounded-lg p-4">
                                <label class="block text-white/80 text-sm font-medium mb-2">
                                    <i class="fas fa-clock mr-2 text-yellow-300"></i>Symptom Duration
                                </label>
                                <select id="symptomDuration" class="w-full p-2 bg-white/20 border border-white/30 rounded-lg text-white">
                                    <option value="">Select duration</option>
                                    <option value="hours">Few hours</option>
                                    <option value="1day">1 day</option>
                                    <option value="2-3days">2-3 days</option>
                                    <option value="week">About a week</option>
                                    <option value="weeks">Several weeks</option>
                                    <option value="chronic">Chronic (months)</option>
                                </select>
                            </div>
                        </div>
                        
                        <button onclick="analyzeSymptoms()" class="mt-6 bg-gradient-to-r from-blue-500 to-purple-600 text-white px-8 py-3 rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105">
                            <i class="fas fa-brain mr-2"></i>Analyze Symptoms with AI
                        </button>
                    </div>
                </div>

                <!-- Advanced Follow-up Questions -->
                <div id="followUpQuestions" class="hidden mb-6">
                    <div class="bg-white/10 rounded-lg p-6">
                        <h3 class="text-xl font-semibold text-white mb-4 flex items-center">
                            <i class="fas fa-question-circle mr-2 text-blue-300"></i>
                            Personalized Follow-up Questions:
                        </h3>
                        <div id="questionsContainer"></div>
                    </div>
                </div>

                <!-- Advanced Results Panel -->
                <div id="symptomsResults" class="hidden">
                    <!-- Medical Disclaimer -->
                    <div class="bg-yellow-500/20 border-l-4 border-yellow-400 p-4 mb-6 rounded-r-lg">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-triangle text-yellow-400 text-xl mr-3"></i>
                            <div>
                                <p class="text-white font-medium">Medical Disclaimer</p>
                                <p class="text-white/80 text-sm">This AI analysis is for informational purposes only and is not a substitute for professional medical diagnosis. Always consult with a qualified healthcare provider for proper medical advice.</p>
                            </div>
                        </div>
                    </div>

                    <!-- AI Analysis Results -->
                    <div id="analysisResult" class="mb-6"></div>
                    
                    <!-- Action Options with Advanced Icons -->
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-green-400 to-green-600 rounded-xl p-6 cursor-pointer hover:from-green-500 hover:to-green-700 transition-all transform hover:scale-105" onclick="showHomeRemedies()">
                            <div class="text-center text-white">
                                <i class="fas fa-home text-3xl mb-3"></i>
                                <h4 class="font-semibold mb-2">Home Remedies</h4>
                                <p class="text-sm opacity-90">Natural treatments & self-care</p>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl p-6 cursor-pointer hover:from-blue-500 hover:to-blue-700 transition-all transform hover:scale-105" onclick="showNearbyDoctors()">
                            <div class="text-center text-white">
                                <i class="fas fa-user-md text-3xl mb-3"></i>
                                <h4 class="font-semibold mb-2">Find Doctors</h4>
                                <p class="text-sm opacity-90">Nearby healthcare providers</p>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-purple-400 to-purple-600 rounded-xl p-6 cursor-pointer hover:from-purple-500 hover:to-purple-700 transition-all transform hover:scale-105" onclick="showTelehealthOptions()">
                            <div class="text-center text-white">
                                <i class="fas fa-video text-3xl mb-3"></i>
                                <h4 class="font-semibold mb-2">Telehealth</h4>
                                <p class="text-sm opacity-90">Online consultations</p>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-red-400 to-red-600 rounded-xl p-6 cursor-pointer hover:from-red-500 hover:to-red-700 transition-all transform hover:scale-105" onclick="showEmergencyOptions()">
                            <div class="text-center text-white">
                                <i class="fas fa-ambulance text-3xl mb-3"></i>
                                <h4 class="font-semibold mb-2">Emergency</h4>
                                <p class="text-sm opacity-90">Urgent care options</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Student Helper Module -->
        <div id="studentHelper" class="hidden max-w-6xl mx-auto">
            <div class="glass-effect rounded-2xl p-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-3xl font-bold text-white flex items-center">
                        <i class="fas fa-graduation-cap mr-3 text-green-400"></i>
                        Smart Student Helper
                        <span class="ml-3 text-sm bg-blue-500 text-white px-3 py-1 rounded-full">
                            <i class="fas fa-robot mr-1"></i>AI Powered
                        </span>
                    </h2>
                    <button onclick="goBack()" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-all">
                        <i class="fas fa-arrow-left mr-2"></i>Back
                    </button>
                </div>

                <div class="grid lg:grid-cols-2 gap-8">
                    <!-- Advanced Leave Note Generator -->
                    <div class="bg-white/10 rounded-xl p-6">
                        <h3 class="text-xl font-semibold text-white mb-6 flex items-center">
                            <i class="fas fa-file-alt mr-2 text-yellow-300"></i>
                            Generate Leave Application
                        </h3>
                        
                        <div class="space-y-4">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-white/80 text-sm font-medium mb-2">
                                        <i class="fas fa-user mr-2"></i>Full Name
                                    </label>
                                    <input type="text" id="studentName" class="w-full p-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:ring-2 focus:ring-green-400" placeholder="Enter your full name">
                                </div>
                                <div>
                                    <label class="block text-white/80 text-sm font-medium mb-2">
                                        <i class="fas fa-id-card mr-2"></i>Student ID
                                    </label>
                                    <input type="text" id="studentId" class="w-full p-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:ring-2 focus:ring-green-400" placeholder="Enter student ID">
                                </div>
                            </div>
                            
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-white/80 text-sm font-medium mb-2">
                                        <i class="fas fa-layer-group mr-2"></i>Class/Grade
                                    </label>
                                    <input type="text" id="studentClass" class="w-full p-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:ring-2 focus:ring-green-400" placeholder="e.g., Grade 10, BSc Year 2">
                                </div>
                                <div>
                                    <label class="block text-white/80 text-sm font-medium mb-2">
                                        <i class="fas fa-building mr-2"></i>Department/Section
                                    </label>
                                    <input type="text" id="department" class="w-full p-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:ring-2 focus:ring-green-400" placeholder="e.g., Science, Arts">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-white/80 text-sm font-medium mb-2">
                                    <i class="fas fa-clipboard-list mr-2"></i>Leave Type
                                </label>
                                <select id="leaveType" class="w-full p-3 bg-white/20 border border-white/30 rounded-lg text-white focus:ring-2 focus:ring-green-400">
                                    <option value="sick">🤒 Sick Leave</option>
                                    <option value="personal">👤 Personal Leave</option>
                                    <option value="family">👨‍👩‍👧‍👦 Family Emergency</option>
                                    <option value="medical">🏥 Medical Appointment</option>
                                    <option value="bereavement">🕊️ Bereavement Leave</option>
                                    <option value="religious">🕌 Religious Observance</option>
                                    <option value="other">📝 Other</option>
                                </select>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-white/80 text-sm font-medium mb-2">
                                        <i class="fas fa-calendar-alt mr-2"></i>From Date
                                    </label>
                                    <input type="date" id="fromDate" class="w-full p-3 bg-white/20 border border-white/30 rounded-lg text-white focus:ring-2 focus:ring-green-400">
                                </div>
                                <div>
                                    <label class="block text-white/80 text-sm font-medium mb-2">
                                        <i class="fas fa-calendar-check mr-2"></i>To Date
                                    </label>
                                    <input type="date" id="toDate" class="w-full p-3 bg-white/20 border border-white/30 rounded-lg text-white focus:ring-2 focus:ring-green-400">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-white/80 text-sm font-medium mb-2">
                                    <i class="fas fa-comment-dots mr-2"></i>Detailed Reason
                                </label>
                                <textarea id="leaveReason" class="w-full p-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:ring-2 focus:ring-green-400" rows="3" placeholder="Provide detailed reason for leave..."></textarea>
                            </div>
                            
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-white/80 text-sm font-medium mb-2">
                                        <i class="fas fa-envelope mr-2"></i>Mentor Email
                                    </label>
                                    <input type="email" id="mentorEmail" class="w-full p-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:ring-2 focus:ring-green-400" placeholder="mentor@school.edu">
                                </div>
                                <div>
                                    <label class="block text-white/80 text-sm font-medium mb-2">
                                        <i class="fas fa-phone mr-2"></i>Contact Number
                                    </label>
                                    <input type="tel" id="contactNumber" class="w-full p-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/60 focus:ring-2 focus:ring-green-400" placeholder="+1 (555) 123-4567">
                                </div>
                            </div>
                            
                            <div class="flex gap-3 pt-4">
                                <button onclick="generateLeaveNote()" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-3 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105">
                                    <i class="fas fa-magic mr-2"></i>Generate Note
                                </button>
                                <button onclick="sendToMentor()" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105">
                                    <i class="fas fa-paper-plane mr-2"></i>Send to Mentor
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Leave Note Preview -->
                    <div class="bg-white/10 rounded-xl p-6">
                        <h3 class="text-xl font-semibold text-white mb-4 flex items-center">
                            <i class="fas fa-eye mr-2 text-blue-300"></i>
                            Live Preview
                        </h3>
                        <div id="leaveNotePreview" class="bg-white rounded-lg p-6 min-h-96 text-gray-800">
                            <div class="text-center text-gray-400 py-20">
                                <i class="fas fa-file-alt text-6xl mb-4"></i>
                                <p>Fill out the form to generate your leave note</p>
                            </div>
                        </div>
                        
                        <div class="flex gap-3 mt-4">
                            <button onclick="downloadLeaveNote()" class="flex-1 bg-gradient-to-r from-gray-600 to-gray-700 text-white px-4 py-2 rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all">
                                <i class="fas fa-download mr-2"></i>Download PDF
                            </button>
                            <button onclick="printLeaveNote()" class="flex-1 bg-gradient-to-r from-indigo-600 to-indigo-700 text-white px-4 py-2 rounded-lg hover:from-indigo-700 hover:to-indigo-800 transition-all">
                                <i class="fas fa-print mr-2"></i>Print
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Modal -->
        <div id="modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-4xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 id="modalTitle" class="text-2xl font-bold text-gray-800 flex items-center"></h3>
                    <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="modalContent"></div>
            </div>
        </div>
    </div>

    <script>
        let currentSymptoms = '';
        let followUpAnswers = {};
        let patientProfile = {};

        function activateSymptomDetector() {
            document.getElementById('moduleSelection').classList.add('hidden');
            document.getElementById('symptomDetector').classList.remove('hidden');
            document.getElementById('symptomDetector').classList.add('fade-in');
        }

        function activateStudentHelper() {
            document.getElementById('moduleSelection').classList.add('hidden');
            document.getElementById('studentHelper').classList.remove('hidden');
            document.getElementById('studentHelper').classList.add('fade-in');
        }

        function goBack() {
            document.getElementById('symptomDetector').classList.add('hidden');
            document.getElementById('studentHelper').classList.add('hidden');
            document.getElementById('moduleSelection').classList.remove('hidden');
            
            // Reset forms
            resetSymptomDetector();
        }

        function resetSymptomDetector() {
            document.getElementById('symptomsInput').value = '';
            document.getElementById('followUpQuestions').classList.add('hidden');
            document.getElementById('symptomsResults').classList.add('hidden');
            document.getElementById('initialSymptoms').classList.remove('hidden');
            currentSymptoms = '';
            followUpAnswers = {};
        }

        function addSymptomTag(symptom) {
            const input = document.getElementById('symptomsInput');
            const currentValue = input.value.trim();
            if (currentValue && !currentValue.endsWith(',') && !currentValue.endsWith('.')) {
                input.value = currentValue + ', ' + symptom;
            } else {
                input.value = currentValue + symptom;
            }
        }

        function analyzeSymptoms() {
            const symptoms = document.getElementById('symptomsInput').value.trim();
            const ageGroup = document.getElementById('ageGroup').value;
            const gender = document.getElementById('gender').value;
            const duration = document.getElementById('symptomDuration').value;
            
            if (!symptoms) {
                alert('Please describe your symptoms first.');
                return;
            }

            // Store patient profile for personalized analysis
            patientProfile = { ageGroup, gender, duration };
            currentSymptoms = symptoms;
            
            // Hide initial input and show follow-up questions
            document.getElementById('initialSymptoms').classList.add('hidden');
            document.getElementById('followUpQuestions').classList.remove('hidden');
            
            // Generate personalized follow-up questions
            generateAdvancedFollowUpQuestions(symptoms, patientProfile);
        }

        function generateAdvancedFollowUpQuestions(symptoms, profile) {
            const questionsContainer = document.getElementById('questionsContainer');
            const questions = getPersonalizedQuestions(symptoms, profile);
            
            let questionsHTML = '';
            questions.forEach((question, index) => {
                questionsHTML += `
                    <div class="mb-6 p-4 bg-white/10 rounded-lg border border-white/20">
                        <label class="block text-white font-medium mb-3 flex items-center">
                            <i class="${question.icon} mr-2 text-blue-300"></i>
                            ${question.text}
                        </label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                            ${question.options.map(option => `
                                <label class="flex items-center p-2 bg-white/10 rounded cursor-pointer hover:bg-white/20 transition-colors">
                                    <input type="radio" name="question_${index}" value="${option.value}" class="mr-2">
                                    <span class="text-white text-sm">${option.label}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            questionsHTML += `
                <button onclick="processAdvancedAnalysis()" class="bg-gradient-to-r from-purple-500 to-pink-600 text-white px-8 py-3 rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all transform hover:scale-105">
                    <i class="fas fa-brain mr-2"></i>Get AI Analysis
                </button>
            `;
            
            questionsContainer.innerHTML = questionsHTML;
        }

        function getPersonalizedQuestions(symptoms, profile) {
            const lowerSymptoms = symptoms.toLowerCase();
            let questions = [];
            
            // Base questions for all patients
            questions.push({
                text: 'How would you rate your overall pain/discomfort level?',
                icon: 'fas fa-thermometer-half',
                options: [
                    { value: 'none', label: '😊 No pain' },
                    { value: 'mild', label: '😐 Mild (1-3)' },
                    { value: 'moderate', label: '😣 Moderate (4-6)' },
                    { value: 'severe', label: '😰 Severe (7-10)' }
                ]
            });

            // Symptom-specific questions
            if (lowerSymptoms.includes('fever') || lowerSymptoms.includes('temperature')) {
                questions.push({
                    text: 'What is your current body temperature?',
                    icon: 'fas fa-thermometer-full',
                    options: [
                        { value: 'normal', label: '🌡️ Normal (98-99°F)' },
                        { value: 'low_fever', label: '🔥 Low fever (100-101°F)' },
                        { value: 'moderate_fever', label: '🔥🔥 Moderate (102-103°F)' },
                        { value: 'high_fever', label: '🚨 High (104°F+)' }
                    ]
                });
            }
            
            if (lowerSymptoms.includes('cough')) {
                questions.push({
                    text: 'What type of cough are you experiencing?',
                    icon: 'fas fa-lungs',
                    options: [
                        { value: 'dry', label: '🏜️ Dry cough' },
                        { value: 'productive', label: '💧 Wet/productive' },
                        { value: 'blood', label: '🩸 With blood' },
                        { value: 'wheezing', label: '🌪️ With wheezing' }
                    ]
                });
            }

            // Age-specific questions
            if (profile.ageGroup === 'child') {
                questions.push({
                    text: 'Is the child eating and drinking normally?',
                    icon: 'fas fa-baby',
                    options: [
                        { value: 'normal', label: '✅ Normal appetite' },
                        { value: 'reduced', label: '⚠️ Reduced appetite' },
                        { value: 'refusing', label: '❌ Refusing food/drink' },
                        { value: 'vomiting', label: '🤮 Vomiting after eating' }
                    ]
                });
            }

            return questions.slice(0, 4); // Limit to 4 questions for better UX
        }

        function processAdvancedAnalysis() {
            // Collect all answers
            const questions = document.querySelectorAll('input[type="radio"]:checked');
            questions.forEach(q => {
                const questionIndex = q.name.split('_')[1];
                followUpAnswers[questionIndex] = q.value;
            });

            // Hide follow-up questions and show results
            document.getElementById('followUpQuestions').classList.add('hidden');
            document.getElementById('symptomsResults').classList.remove('hidden');
            
            // Generate comprehensive analysis
            const analysis = generateComprehensiveAnalysis();
            document.getElementById('analysisResult').innerHTML = analysis;
        }

        function generateComprehensiveAnalysis() {
            const symptoms = currentSymptoms.toLowerCase();
            let riskLevel = 'low';
            let urgency = 'routine';
            let recommendations = [];
            let possibleConditions = [];
            
            // Advanced symptom analysis
            if (symptoms.includes('chest pain') || symptoms.includes('difficulty breathing') || symptoms.includes('shortness of breath')) {
                riskLevel = 'critical';
                urgency = 'immediate';
                possibleConditions.push('Cardiac event', 'Pulmonary embolism', 'Pneumonia');
                recommendations.push('Seek immediate emergency medical attention');
                recommendations.push('Call 911 or go to nearest emergency room');
            } else if (symptoms.includes('severe headache') && symptoms.includes('fever') && symptoms.includes('neck stiffness')) {
                riskLevel = 'high';
                urgency = 'urgent';
                possibleConditions.push('Meningitis', 'Severe infection');
                recommendations.push('Seek urgent medical care within 2-4 hours');
            } else if (symptoms.includes('fever') && symptoms.includes('cough')) {
                riskLevel = 'moderate';
                urgency = 'same-day';
                possibleConditions.push('Respiratory infection', 'Flu', 'COVID-19');
                recommendations.push('Monitor symptoms closely');
                recommendations.push('Consider COVID-19 testing');
                recommendations.push('Consult healthcare provider if symptoms worsen');
            } else {
                possibleConditions.push('Minor illness', 'Viral infection', 'Stress-related symptoms');
                recommendations.push('Rest and monitor symptoms');
                recommendations.push('Stay hydrated');
                recommendations.push('Consider over-the-counter remedies');
            }

            // Personalized recommendations based on patient profile
            if (patientProfile.ageGroup === 'senior') {
                recommendations.push('Monitor symptoms more closely due to age');
                recommendations.push('Consider contacting healthcare provider sooner');
            }

            const severityColors = {
                'critical': { bg: 'severity-critical', text: 'text-white', icon: 'fas fa-exclamation-triangle' },
                'high': { bg: 'severity-high', text: 'text-white', icon: 'fas fa-exclamation-circle' },
                'moderate': { bg: 'severity-moderate', text: 'text-gray-800', icon: 'fas fa-info-circle' },
                'low': { bg: 'severity-low', text: 'text-white', icon: 'fas fa-check-circle' }
            };

            const colors = severityColors[riskLevel];
            
            return `
                <div class="${colors.bg} rounded-xl p-6 mb-6 text-center">
                    <i class="${colors.icon} text-4xl mb-3 ${colors.text}"></i>
                    <h3 class="text-2xl font-bold ${colors.text} mb-2">Risk Assessment: ${riskLevel.toUpperCase()}</h3>
                    <p class="${colors.text} opacity-90">Urgency Level: ${urgency.charAt(0).toUpperCase() + urgency.slice(1)}</p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white/10 rounded-lg p-4">
                        <h4 class="font-semibold text-white mb-3 flex items-center">
                            <i class="fas fa-stethoscope mr-2 text-blue-300"></i>
                            Possible Conditions
                        </h4>
                        <ul class="space-y-2">
                            ${possibleConditions.map(condition => `
                                <li class="text-white/80 flex items-center">
                                    <i class="fas fa-dot-circle mr-2 text-blue-300 text-xs"></i>
                                    ${condition}
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    
                    <div class="bg-white/10 rounded-lg p-4">
                        <h4 class="font-semibold text-white mb-3 flex items-center">
                            <i class="fas fa-lightbulb mr-2 text-yellow-300"></i>
                            AI Recommendations
                        </h4>
                        <ul class="space-y-2">
                            ${recommendations.map(rec => `
                                <li class="text-white/80 flex items-start">
                                    <i class="fas fa-arrow-right mr-2 text-green-300 text-xs mt-1"></i>
                                    ${rec}
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
                
                <div class="bg-blue-500/20 border border-blue-400/30 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-2 flex items-center">
                        <i class="fas fa-brain mr-2 text-purple-300"></i>
                        AI Analysis Explanation
                    </h4>
                    <p class="text-white/80 text-sm">
                        Based on your reported symptoms "${currentSymptoms}", combined with your age group (${patientProfile.ageGroup || 'not specified'}), 
                        gender (${patientProfile.gender || 'not specified'}), and symptom duration (${patientProfile.duration || 'not specified'}), 
                        our AI system has assessed your condition as <strong>${riskLevel} risk</strong> requiring <strong>${urgency}</strong> attention.
                    </p>
                </div>
            `;
        }

        function showHomeRemedies() {
            const remedies = [
                { icon: 'fas fa-tint', title: 'Hydration', desc: 'Drink 8-10 glasses of water daily, herbal teas, and clear broths' },
                { icon: 'fas fa-bed', title: 'Rest', desc: 'Get 7-9 hours of quality sleep and avoid strenuous activities' },
                { icon: 'fas fa-seedling', title: 'Honey & Ginger', desc: 'Natural anti-inflammatory and soothing properties' },
                { icon: 'fas fa-thermometer-half', title: 'Temperature Control', desc: 'Use cold/warm compresses as appropriate for symptoms' },
                { icon: 'fas fa-wind', title: 'Fresh Air', desc: 'Ensure good ventilation and consider humidifier use' },
                { icon: 'fas fa-apple-alt', title: 'Nutrition', desc: 'Eat light, nutritious foods rich in vitamins C and D' },
                { icon: 'fas fa-meditation', title: 'Stress Relief', desc: 'Practice deep breathing, meditation, or gentle yoga' },
                { icon: 'fas fa-pills', title: 'OTC Medications', desc: 'Consider appropriate over-the-counter pain relievers if needed' }
            ];
            
            const remediesHTML = remedies.map(remedy => `
                <div class="bg-gradient-to-r from-green-50 to-green-100 border border-green-200 rounded-lg p-4 mb-3">
                    <div class="flex items-start space-x-3">
                        <i class="${remedy.icon} text-green-600 text-xl mt-1"></i>
                        <div>
                            <h5 class="font-semibold text-green-800 mb-1">${remedy.title}</h5>
                            <p class="text-green-700 text-sm">${remedy.desc}</p>
                        </div>
                    </div>
                </div>
            `).join('');
            
            showModal('<i class="fas fa-home mr-2 text-green-600"></i>Personalized Home Remedies', remediesHTML + `
                <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-yellow-600 mr-2"></i>
                        <p class="text-yellow-800 text-sm"><strong>Important:</strong> These are general suggestions. Consult a healthcare provider if symptoms worsen, persist, or if you have underlying health conditions.</p>
                    </div>
                </div>
            `);
        }

        function showNearbyDoctors() {
            const doctors = [
                { 
                    name: 'Dr. Sarah Johnson', 
                    specialty: 'General Practice', 
                    rating: 4.8,
                    phone: '+1-555-0123', 
                    address: '123 Health St, Medical District',
                    distance: '0.5 miles',
                    availability: 'Available today',
                    insurance: 'Most insurance accepted'
                },
                { 
                    name: 'Dr. Michael Chen', 
                    specialty: 'Internal Medicine', 
                    rating: 4.9,
                    phone: '+1-555-0456', 
                    address: '456 Care Ave, Downtown',
                    distance: '1.2 miles',
                    availability: 'Next available: Tomorrow 2 PM',
                    insurance: 'Medicare, Medicaid, Private'
                },
                { 
                    name: 'Dr. Emily Rodriguez', 
                    specialty: 'Family Medicine', 
                    rating: 4.7,
                    phone: '+1-555-0789', 
                    address: '789 Wellness Blvd, Uptown',
                    distance: '2.1 miles',
                    availability: 'Walk-ins welcome',
                    insurance: 'All major insurance plans'
                }
            ];
            
            const doctorsHTML = doctors.map(doctor => `
                <div class="bg-white border border-gray-200 rounded-xl p-6 mb-4 hover:shadow-lg transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="text-xl font-bold text-gray-800 flex items-center">
                                <i class="fas fa-user-md mr-2 text-blue-600"></i>
                                ${doctor.name}
                            </h4>
                            <p class="text-blue-600 font-medium">${doctor.specialty}</p>
                            <div class="flex items-center mt-1">
                                <div class="flex text-yellow-400">
                                    ${'★'.repeat(Math.floor(doctor.rating))}
                                </div>
                                <span class="ml-2 text-gray-600 text-sm">${doctor.rating}/5.0</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">
                                <i class="fas fa-map-marker-alt mr-1"></i>${doctor.distance}
                            </span>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <p class="text-gray-600 mb-1">
                                <i class="fas fa-phone text-blue-500 mr-2"></i>
                                <a href="tel:${doctor.phone}" class="text-blue-600 hover:underline">${doctor.phone}</a>
                            </p>
                            <p class="text-gray-600">
                                <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>
                                ${doctor.address}
                            </p>
                        </div>
                        <div>
                            <p class="text-gray-600 mb-1">
                                <i class="fas fa-clock text-green-500 mr-2"></i>
                                ${doctor.availability}
                            </p>
                            <p class="text-gray-600">
                                <i class="fas fa-shield-alt text-purple-500 mr-2"></i>
                                ${doctor.insurance}
                            </p>
                        </div>
                    </div>
                    
                    <div class="flex gap-2 mt-4">
                        <button class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-calendar-plus mr-2"></i>Book Appointment
                        </button>
                        <button class="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-directions mr-2"></i>Get Directions
                        </button>
                    </div>
                </div>
            `).join('');
            
            showModal('<i class="fas fa-hospital mr-2 text-blue-600"></i>Nearby Healthcare Providers', doctorsHTML);
        }

        function showTelehealthOptions() {
            const telehealthOptions = [
                { 
                    name: 'HealthConnect Online', 
                    description: 'Video consultations with board-certified doctors',
                    price: '$49/consultation',
                    waitTime: '< 15 minutes',
                    rating: 4.8,
                    features: ['24/7 availability', 'Prescription services', 'Follow-up care'],
                    link: 'https://healthconnect.example.com' 
                },
                { 
                    name: 'MediChat 24/7', 
                    description: 'Round-the-clock medical support and consultations',
                    price: '$39/consultation',
                    waitTime: '< 5 minutes',
                    rating: 4.6,
                    features: ['Instant messaging', 'Video calls', 'Mental health support'],
                    link: 'https://medichat.example.com' 
                },
                { 
                    name: 'VirtualCare Plus', 
                    description: 'Specialized telehealth services with expert doctors',
                    price: '$59/consultation',
                    waitTime: '< 30 minutes',
                    rating: 4.9,
                    features: ['Specialist consultations', 'Lab result reviews', 'Care coordination'],
                    link: 'https://virtualcare.example.com' 
                }
            ];
            
            const optionsHTML = telehealthOptions.map(option => `
                <div class="bg-white border border-gray-200 rounded-xl p-6 mb-4 hover:shadow-lg transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="text-xl font-bold text-gray-800 flex items-center">
                                <i class="fas fa-video mr-2 text-purple-600"></i>
                                ${option.name}
                            </h4>
                            <p class="text-gray-600 mt-1">${option.description}</p>
                            <div class="flex items-center mt-2">
                                <div class="flex text-yellow-400">
                                    ${'★'.repeat(Math.floor(option.rating))}
                                </div>
                                <span class="ml-2 text-gray-600 text-sm">${option.rating}/5.0</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-green-600">${option.price}</div>
                            <div class="text-sm text-gray-500">Average wait: ${option.waitTime}</div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h5 class="font-semibold text-gray-700 mb-2">Features:</h5>
                        <div class="flex flex-wrap gap-2">
                            ${option.features.map(feature => `
                                <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">
                                    <i class="fas fa-check mr-1"></i>${feature}
                                </span>
                            `).join('')}
                        </div>
                    </div>
                    
                    <button onclick="window.open('${option.link}', '_blank')" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white px-4 py-3 rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all transform hover:scale-105">
                        <i class="fas fa-video mr-2"></i>Start Consultation Now
                    </button>
                </div>
            `).join('');
            
            showModal('<i class="fas fa-laptop-medical mr-2 text-purple-600"></i>Telehealth Consultation Options', optionsHTML + `
                <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                        <p class="text-blue-800 text-sm"><strong>Note:</strong> These are sample telehealth services. Please verify credentials, licensing, and availability in your area before use.</p>
                    </div>
                </div>
            `);
        }

        function showEmergencyOptions() {
            const emergencyOptions = [
                {
                    title: 'Call 911',
                    description: 'For life-threatening emergencies',
                    icon: 'fas fa-phone',
                    color: 'red',
                    action: 'tel:911'
                },
                {
                    title: 'Nearest Emergency Room',
                    description: 'City General Hospital - 2.1 miles',
                    icon: 'fas fa-hospital',
                    color: 'blue',
                    action: 'https://maps.google.com'
                },
                {
                    title: 'Urgent Care Center',
                    description: 'QuickCare Clinic - 0.8 miles',
                    icon: 'fas fa-clinic-medical',
                    color: 'green',
                    action: 'https://maps.google.com'
                },
                {
                    title: 'Poison Control',
                    description: '24/7 Poison Control Hotline',
                    icon: 'fas fa-skull-crossbones',
                    color: 'purple',
                    action: 'tel:1-800-222-1222'
                }
            ];

            const optionsHTML = emergencyOptions.map(option => `
                <div class="bg-${option.color}-50 border border-${option.color}-200 rounded-xl p-6 mb-4 hover:shadow-lg transition-shadow">
                    <div class="flex items-center mb-4">
                        <div class="bg-${option.color}-600 text-white p-3 rounded-full mr-4">
                            <i class="${option.icon} text-xl"></i>
                        </div>
                        <div>
                            <h4 class="text-xl font-bold text-${option.color}-800">${option.title}</h4>
                            <p class="text-${option.color}-600">${option.description}</p>
                        </div>
                    </div>
                    <button onclick="window.open('${option.action}', '_blank')" class="w-full bg-${option.color}-600 text-white px-4 py-3 rounded-lg hover:bg-${option.color}-700 transition-colors">
                        <i class="fas fa-external-link-alt mr-2"></i>Access Now
                    </button>
                </div>
            `).join('');

            showModal('<i class="fas fa-ambulance mr-2 text-red-600"></i>Emergency Care Options', optionsHTML + `
                <div class="mt-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-red-600 mr-2"></i>
                        <p class="text-red-800 text-sm"><strong>Emergency Warning:</strong> If you are experiencing chest pain, difficulty breathing, severe bleeding, or loss of consciousness, call 911 immediately.</p>
                    </div>
                </div>
            `);
        }

        function generateLeaveNote() {
            const studentName = document.getElementById('studentName').value;
            const studentId = document.getElementById('studentId').value;
            const studentClass = document.getElementById('studentClass').value;
            const department = document.getElementById('department').value;
            const leaveType = document.getElementById('leaveType').value;
            const fromDate = document.getElementById('fromDate').value;
            const toDate = document.getElementById('toDate').value;
            const reason = document.getElementById('leaveReason').value;
            const contactNumber = document.getElementById('contactNumber').value;
            
            if (!studentName || !studentId || !fromDate || !toDate || !reason) {
                alert('Please fill in all required fields.');
                return;
            }
            
            const currentDate = new Date().toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            const leaveTypeText = {
                'sick': '🤒 Sick Leave',
                'personal': '👤 Personal Leave',
                'family': '👨‍👩‍👧‍👦 Family Emergency',
                'medical': '🏥 Medical Appointment',
                'bereavement': '🕊️ Bereavement Leave',
                'religious': '🕌 Religious Observance',
                'other': '📝 Leave of Absence'
            };
            
            const fromDateFormatted = new Date(fromDate).toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            const toDateFormatted = new Date(toDate).toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            const leaveNote = `
                <div class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-lg">
                    <div class="text-center border-b-2 border-gray-300 pb-6 mb-6">
                        <div class="text-blue-600 text-4xl mb-2">🎓</div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">LEAVE APPLICATION</h2>
                        <p class="text-gray-600">Date: ${currentDate}</p>
                    </div>
                    
                    <div class="space-y-4 mb-6">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-gray-700"><strong>To:</strong> The Mentor/Counselor</p>
                                <p class="text-gray-700"><strong>From:</strong> ${studentName}</p>
                            </div>
                            <div>
                                <p class="text-gray-700"><strong>Student ID:</strong> ${studentId}</p>
                                ${studentClass ? `<p class="text-gray-700"><strong>Class:</strong> ${studentClass}</p>` : ''}
                                ${department ? `<p class="text-gray-700"><strong>Department:</strong> ${department}</p>` : ''}
                            </div>
                        </div>
                        <p class="text-gray-700"><strong>Subject:</strong> Application for ${leaveTypeText[leaveType]}</p>
                        ${contactNumber ? `<p class="text-gray-700"><strong>Contact:</strong> ${contactNumber}</p>` : ''}
                    </div>
                    
                    <div class="space-y-4 text-gray-700 leading-relaxed">
                        <p>Dear Sir/Madam,</p>
                        <p>I am writing to formally request ${leaveTypeText[leaveType].toLowerCase()} from <strong>${fromDateFormatted}</strong> to <strong>${toDateFormatted}</strong>.</p>
                        
                        <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-blue-500">
                            <p><strong>Reason for Leave:</strong></p>
                            <p class="mt-2">${reason}</p>
                        </div>
                        
                        <p>I kindly request your approval for this leave. I will ensure to:</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>Catch up on any missed coursework and assignments upon my return</li>
                            <li>Coordinate with classmates for notes and updates</li>
                            <li>Complete any pending assignments before my leave begins</li>
                            <li>Inform you immediately if my return date changes</li>
                        </ul>
                        
                        <p>Thank you for your understanding and consideration of my request.</p>
                    </div>
                    
                    <div class="mt-8 pt-6 border-t border-gray-300">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-gray-700">Respectfully yours,</p>
                                <div class="mt-12 border-b border-gray-400 w-48">
                                    <p class="text-gray-800 font-semibold pb-2">${studentName}</p>
                                </div>
                                <p class="text-gray-600 text-sm mt-1">Student Signature</p>
                            </div>
                            <div class="text-right">
                                <p class="text-gray-700">Date: ${currentDate}</p>
                                <div class="mt-12 border-b border-gray-400 w-48">
                                    <p class="text-gray-600 pb-2">_________________</p>
                                </div>
                                <p class="text-gray-600 text-sm mt-1">Mentor/Counselor Approval</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('leaveNotePreview').innerHTML = leaveNote;
        }

        function sendToMentor() {
            const mentorEmail = document.getElementById('mentorEmail').value;
            const studentName = document.getElementById('studentName').value;
            
            if (!mentorEmail) {
                alert('Please enter mentor email address.');
                return;
            }
            
            if (!document.getElementById('leaveNotePreview').innerHTML.includes('LEAVE APPLICATION')) {
                alert('Please generate the leave note first.');
                return;
            }
            
            // Simulate sending email with loading animation
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Sending...';
            button.disabled = true;
            
            setTimeout(() => {
                button.innerHTML = '<i class="fas fa-check mr-2"></i>Sent Successfully!';
                button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                button.classList.add('bg-green-600');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                    button.classList.remove('bg-green-600');
                    button.classList.add('bg-blue-600', 'hover:bg-blue-700');
                }, 2000);
                
                alert(`✅ Leave application has been successfully sent to ${mentorEmail}!\n\n📧 Email includes:\n• Formatted leave application\n• Student contact information\n• Automatic read receipt request\n\nNote: This is a demo. In a real application, this would integrate with an email service.`);
            }, 2000);
        }

        function downloadLeaveNote() {
            if (!document.getElementById('leaveNotePreview').innerHTML.includes('LEAVE APPLICATION')) {
                alert('Please generate the leave note first.');
                return;
            }
            
            // Simulate PDF download with loading animation
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating PDF...';
            button.disabled = true;
            
            setTimeout(() => {
                button.innerHTML = '<i class="fas fa-check mr-2"></i>Downloaded!';
                button.classList.remove('bg-gray-600', 'hover:bg-gray-700');
                button.classList.add('bg-green-600');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                    button.classList.remove('bg-green-600');
                    button.classList.add('bg-gray-600', 'hover:bg-gray-700');
                }, 2000);
                
                alert('📄 PDF download initiated!\n\n✨ Features included:\n• Professional formatting\n• Digital signature fields\n• Watermark protection\n• Print-ready layout\n\nNote: This is a demo. In a real application, this would generate and download a PDF file.');
            }, 1500);
        }

        function printLeaveNote() {
            if (!document.getElementById('leaveNotePreview').innerHTML.includes('LEAVE APPLICATION')) {
                alert('Please generate the leave note first.');
                return;
            }
            
            const printContent = document.getElementById('leaveNotePreview').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Leave Application - Print</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            .no-print { display: none; }
                            @media print {
                                body { margin: 0; }
                                .page-break { page-break-before: always; }
                            }
                        </style>
                    </head>
                    <body>
                        ${printContent}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function showModal(title, content) {
            document.getElementById('modalTitle').innerHTML = title;
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        // Set default dates and initialize
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            document.getElementById('fromDate').value = today.toISOString().split('T')[0];
            document.getElementById('toDate').value = tomorrow.toISOString().split('T')[0];
        });

        // Close modal when clicking outside
        document.getElementById('modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'976d5046277d852b',t:'MTc1NjQ4Mzc3NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
